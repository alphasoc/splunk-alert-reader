# AlphaSOC Splunk Alert Reader

> Emit AlphaSOC alerts indexed in Splunk to stdout.

Splunk Alert Reader retrieves alerts generated by [DNS Analytics for Splunk](https://splunkbase.splunk.com/app/1657/) and outputs them to `stdout` in an [nfr](https://github.com/alphasoc/nfr)-compatible JSON format.

At the first run, the tool retrieves alerts which are at most 60 minutes old (this can be modified in the config file). The subsequent runs return new alerts only. This behavior makes it easy to schedule it with cron at any interval. The emitted alerts may be then processed further (e.g. escalated to SIEM).

## Requirements

The tool requires Python >=2.7 or >=3.1. No 3rd party Python libraries are required. The [Splunk SDK for Python](http://dev.splunk.com/python) is included in the repository. It doesn't have to be run from the Search Head, as it connects to the Splunk's service port over the network.

## Installation and usage example

```sh
git clone https://github.com/alphasoc/splunk-alert-reader.git
cd splunk-alert-reader
cp example.ini config.ini
```

After completing the steps above, update config.ini with your Splunk credentials and adjust other configuration options as needed. Ensure, that the tool can connect to the Splunk's service port (default 8089). After doing that, you may run the script:

```sh
python main.py --config config.ini
```

## Alert format

The tool emits the alerts in a JSON format, one alert per line. By default, alerts my consist of more than one corresponding raw DNS event and/or assigned threat. You can change this behavior by adjusting the `unfold` config option. When changed to 1, the tool will emit one entry per DNS event and threat.

### Alert example

```json
{
  "threats": [
    {
      "policy": true,
      "desc": "Multiple requests for DGA domains indicating infection",
      "id": "dga_volume",
      "severity": 4
    },
    {
      "policy": true,
      "desc": "Multiple requests to unreachable domains",
      "id": "unreachable_domain_volume",
      "severity": 2
    }
  ],
  "risk": 4,
  "ip": "10.14.1.39",
  "fqdn": "rproahjondxj.net",
  "ts": ["2018-04-26T12:40:41+00:00", "2018-04-26T12:39:21+00:00"],
  "record_type": "A",
  "flags": ["perplexing_domain", "unreachable_domain"],
  "groups": [
    {
      "desc": "Zurich"
    }
  ],
  "type": "alert"
}
```

(note: the above alert would be unfolded to 4 separate ones, as it contains two raw DNS event timestamps and two assigned threats)

## Release History

* 0.0.1
  * Initial release

## License

Distributed under the MIT license. See `LICENSE` for more information.

## Authors

AlphaSOC â€“ [website](https://www.alphasoc.com) | [twitter](https://twitter.com/alphasoc) | hello@alphasoc.com
